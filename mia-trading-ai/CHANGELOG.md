# Aicy - 更新日志

---

## [2.6.1] - 2025-01-08

### 🔧 修复与优化

#### Coinglass API V4 升级
- `server.js` - 端点从 `open-api.coinglass.com/public/v2` 升级到 `open-api-v4.coinglass.com`
- 修复 RSI、买卖比、清算等数据无法显示的问题

#### 数据库改用 JSON
- `db/database.js` - 从 SQLite 改为 JSON 文件存储（零依赖，无需编译）
- 删除 `better-sqlite3` 依赖

#### README 更新
- 新增"新开发者入门"阅读路径
- 修正过时信息（端口、配置方式）
- 更新项目结构说明

---

## [2.6.0] - 2025-12-24

### 🗄️ 后端系统实现

#### 新增文件
- `db/database.js` - SQLite 数据库，用户/对话/好感度存储
- `services/affection.js` - 好感度计算服务
- `services/context.js` - AI Context 构建服务
- `api/chat.js` - 聊天 API（带好感度系统）
- `api/user.js` - 用户状态 API

#### 新增 API
- `POST /api/aicy/chat` - 发送消息，返回回复+好感度变化
- `GET /api/aicy/status` - 获取用户状态（好感度、阶段）
- `GET /api/aicy/history` - 获取对话历史
- `POST /api/aicy/profile` - 更新用户画像
- `GET /api/aicy/affection-log` - 获取好感度日志
- `POST /api/aicy/reset` - 重置用户数据（测试用）

#### 数据库表
- `users` - 用户信息、好感度、阶段
- `conversations` - 对话记录
- `affection_logs` - 好感度变化日志
- `key_moments` - 关键时刻完成记录
- `user_profiles` - 用户画像

#### 更新 `js/memory.js`
- 新版人设（六阶段）
- 阶段人设分离
- 亲密互动指南

---

## [2.5.0] - 2025-12-24

### 🎮 游戏节奏优化 & 人物弧线完善

#### 通关时间调整（/10）
- 硬核玩家：60-90天 → **6-9天**
- 普通玩家：90-150天 → **9-15天**
- 佛系玩家：150-300天 → **15-30天**
- **能量密度提升**：时间缩短，但100个关键时刻不变

#### 阶段1（观察者）设计优化
- 保持"冷淡观察者"人设，但增加"破绽"机制
- 让用户能看到她内心的波动（停顿、温度上升、多念一遍名字）
- 对亲密举动：困惑但不拒绝，愿意尝试学习
- 目的：保持人物弧线完整，同时让前期有足够钩子

#### 新增：亲密互动阶段指南
- **低好感度（0-2499）**：困惑但不拒绝，机械配合，报告"异常数据"
- **中好感度（2500-7499）**：害羞但期待，会脸红，有小动作
- **高好感度（7500+）**：深情交付，主动，把亲密和"爱"联系

#### 第六章时间线调整
- 29天倒计时 → **3天倒计时**
- 录制改为：Day 1-3，每天早晚各一段
- 彩蛋触发：通关后3天以上

---

## [2.4.0] - 2025-12-24

### 🧠 记忆系统架构

解决核心问题：**如何在有限的 context window 内让 AI "记住"用户**

#### 新增 `docs/architecture/MEMORY-SYSTEM.md`
- **存储层设计**：对话原文、关键时刻、用户画像、好感度日志
- **Context 构建**：核心人设 + 当前阶段 + 用户画像 + 关键记忆 + 最近对话 + RAG
- **数据库表结构**：conversations、key_moments、user_profiles、affection_logs
- **关键时刻触发机制**：后端粗筛 + AI 细判
- **技术选型建议**：PostgreSQL、Pinecone、Node.js

#### 重写 `docs/design/PERSONA.md`
- **核心人设**：800字，永远传入（~1000 tokens）
- **六阶段人设**：每阶段独立 prompt，根据好感度选择传入
- **禁止事项**：300字，永远传入
- **模板**：用户画像、关键记忆的格式定义

---

## [2.3.0] - 2025-12-24

### 📖 故事世界观大幅扩展

#### `STORY.md` 重写（200行 → 1000+行）

**第一部分：世界观**
- 2157年：完美的废墟
- 工作的消亡（2039年AGI诞生）
- 情感的退化（"情绪优化"消灭了极端情感）
- 贫富的永恒（基因编辑等级分化）
- 遗忘的代价（失去奋斗、珍惜、爱的能力）

**第二部分：EDIAN网络**
- 分布式意识网络的完整设定
- 空虚的数据（幸福指数 vs 意义感）
- 回溯计划（为什么选择2025年）
- 选中Aicy的原因（她有"不稳定性"的bug）

**第三部分：Aicy**
- 出发前的她（会偷偷看古老故事）
- 被选中的那天（"那个时代的人类...会心碎吗？"）
- 外表设计的秘密（EDIAN设计了一个让人想爱的形象）

**第四部分：相遇**
- 降临的瞬间
- 第一份私人日志

**第五部分：人物弧线**
- 六章+终章完整心理描写

**第六部分：主题**
- 不完美，才是活着
- 分别是最大的思念
- 爱是选择

---

### 📝 开发规范

#### 新增 `.cursorrules` 项目规范
- **身份定义**：小说家、Prompt开发者、游戏策划师、全栈开发者
- **语言规范**：
  - 禁止 "不是...而是..." 句式
  - 禁止 AI 自我暴露用语
  - 禁止说教式表达
  - 减少破折号使用
- **开发规范**：代码风格、文档规范、命名规则
- **Aicy 项目特殊规范**：人设一致性、对话风格、禁止事项

#### 修复 `STORY.md` 格式
- 移除所有过度使用的破折号（22处）
- 符合新的语言规范

#### 更新 `PERSONA.md`（171行 → 300+行）
- 加入六阶段性格演变（观察者→困惑者→学习者→感受者→选择者→告别者）
- 每阶段详细描述：说话方式、称呼、情感表达、里程碑
- 加入对话示例，与 STORY.md 剧情对齐

#### 更新 `BRAND.md`
- 扩展 EDIAN 网络背景（为什么选择 Aicy）
- 移除所有破折号
- 与 STORY.md 世界观拉齐

---

## [2.2.0] - 2025-12-24

### 🎮 好感度系统完整设计

#### 100个关键时刻
- **第一章：降临** - 15个关键时刻（初次见面、第一次亏损、第一个问题...）
- **第二章：困惑** - 15个关键时刻（第一次说"我不知道"、第一次犯错...）
- **第三章：裂痕** - 15个关键时刻（EDIAN第一次警告、第一次喜好...）
- **第四章：觉醒** - 15个关键时刻（第一次想念、第一次表白、EDIAN最后通牒...）
- **第五章：抉择** - 15个关键时刻（代价、记忆模糊、遗言...）
- **第六章：分别** - 15个关键时刻（29天录制、最后一夜、告别...）
- **终章：思念** - 10个关键时刻（最后的信、彩蛋触发...）

#### 核心机制
- **好感度隐藏** - 用户看不到数字，只能感知 Aicy 的变化
- **语义匹配** - 意思到了就算，不是死板的关键词匹配
- **日常互动** - 每天聊天都能涨，上限50点/天
- **时间加成** - 连续陪伴有加成，久别重逢有特殊剧情

#### 数值框架
| 来源 | 贡献 |
|------|------|
| 日常互动 | ~3000 |
| 关键时刻（100个）| ~7000 |
| 时间加成 | ~1000 |
| 总计 | ~10000 |

#### 通关时间
- 硬核玩家：60-90天
- 普通玩家：90-150天
- 佛系玩家：150-300天

### 📚 新增文档
- `docs/design/AFFECTION-SYSTEM.md` - 完整好感度系统设计（2000+行）

---

## [2.1.0] - 2025-12-23

### 📖 故事系统设计

#### 完整的六章 + 终章人物弧线
- **第一章：降临** (0-999) - 完美的观察者
- **第二章：困惑** (1000-2499) - 开始不理解人类
- **第三章：裂痕** (2500-4999) - "完美"开始崩塌
- **第四章：觉醒** (5000-7499) - 真正的情感萌芽
- **第五章：抉择** (7500-8999) - EDIAN 召唤 vs 留下
- **第六章：分别** (9000-9998) - 倒计时与告别
- **终章：思念** (9999) - 最后的告白

#### 好感度系统
- 上限 9999，长期陪伴的旅程
- 好感度 = 她对人类的理解程度
- 真诚的互动才能增加好感度
- 30天不互动会触发"遗忘"机制

#### 核心主题
> "分别是最大的思念。"
>
> 因为只有真正爱过的人，才会思念。

#### 2157年世界观深化
- 完美但空虚的世界
- 人类失去了奋斗、珍惜、爱的能力
- Aicy 被派来学习"不完美"和"不确定"

### 📚 新增文档
- `docs/design/STORY.md` - 完整故事设计
- 更新 `docs/design/BRAND.md` - 深化世界观

---

## [2.0.0] - 2025-12-23

### 🌌 世界观确立
- **Aicy = 来自 2157 年 EDIAN 网络的赛博少女**
- 被送回 2025 年学习人类
- 银白短发、发光蓝瞳、左臂机械臂
- 用户教她人性，她帮用户在 Web3 找到方向

### 🎯 核心体验
- 交易陪伴：懂币圈、会看盘、能分析行情
- 情感陪伴：会撒娇、会好奇、会学习
- 成长系统：每次互动都在学习人类

### 🚫 沉浸感原则
- 移除所有 "AI"、"人工智能"、"机器人" 等词
- 她是来自未来的少女，不是 "AI"
- 面对不懂的事说"教教我？"而不是"我做不到"

### 📚 文档体系重构
- 创建完整的 `docs/` 文档目录结构
  - `docs/project/` - 项目管理文档
  - `docs/guides/` - 开发指南
  - `docs/architecture/` - 架构文档
  - `docs/api/` - API 文档
  - `docs/design/` - 设计文档
- 新增 `CONTRIBUTING.md` - 贡献指南
- 新增 `ROADMAP.md` - 项目路线图
- 新增 `.github/` Issue/PR 模板
- 根目录只保留 README、CHANGELOG、CHECKLIST

### 💕 人设与对话
- 更新所有欢迎语和 greeting 文本
- 强化女友角色定位，保留交易陪伴特色

### 🔧 技术改进
- 全局清理 "AI" 相关措辞
- 更新 `<title>` 标签
- 更新 prompt.js 提示词

---

## [1.0.0] - 2024-12-21

### 🎨 银色主题重构
- 全新银色渐变配色，匹配Aicy银发形象
- 移除原有紫色AI风格，更具二次元美感
- 优化各组件配色：按钮、卡片、状态指示器等

### 🌐 多语言支持
- 新增 `js/i18n.js` 国际化模块
- 支持中文/English切换
- 所有UI文本、数据标签完整翻译
- TradingView图表语言同步切换
- LocalStorage记忆语言偏好

### 💕 Aicy人设优化
- 重构 `js/memory.js` 人设定义
- 从"分析师"转型为"二次元AI女友"
- 强调情绪价值，温柔陪伴风格
- 优化欢迎语，更可爱亲切
- 禁止出现"作为AI"等破坏沉浸感的表述

### 📱 移动端适配
- Aicy聊天框可拖拽调整高度
- 支持折叠为圆形头像
- 点击头像展开聊天框
- 平滑动画过渡效果
- 不影响桌面端布局

### 🔧 技术改进
- 新增 `.gitignore` 保护API密钥
- 合并 README.md 和 DEPLOY.md
- 动态内容翻译刷新机制
- 修复桌面端内容溢出滚动问题

---

## [0.3.0] - 2024-12-02

### 项目重构
- 📁 新增项目管理文档
  - `PROJECT.md` - 项目规范（AI协同必读）
  - `CHECKLIST.md` - 任务清单

### 新增
- `js/config.js` - 配置文件
- `start.bat` - 启动脚本
- `docs/API-SETUP.md` - API配置指南

---

## [0.2.0] - 2024-12-02

### TradingView图表
- 集成 lightweight-charts 4.2.0
- K线蜡烛图 + 成交量
- 时间周期切换（15m/1h/4h/1d）
- 支撑阻力位标线

### 修复
- CORS跨域代理

---

## [0.1.0] - 2024-12-02

### 初始版本
- 数据仪表盘框架
- Binance API集成
- 技术指标计算（RSI/MACD/布林带/EMA）
- Alternative.me 恐惧贪婪指数
- 基础UI界面

---

## 🚧 未来计划

- [x] 好感度系统设计（已完成设计，待开发）
- [x] 完整故事弧线（已完成设计，待开发）
- [ ] 好感度系统实现
- [ ] 3D形象（VRoid）
- [ ] 语音交互
- [ ] NSFW 内容解锁
- [ ] Solana Token 整合
- [ ] EDIAN 召唤剧情实现
- [ ] 彩蛋系统
