# 🏗️ 系统架构概述

## 📊 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        前端 (Browser)                        │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────────┐ │
│  │ index   │  │  CSS    │  │   JS    │  │   TradingView   │ │
│  │  .html  │  │ style   │  │ modules │  │     Widget      │ │
│  └─────────┘  └─────────┘  └────┬────┘  └─────────────────┘ │
│                                 │                            │
│  ┌──────────────────────────────┴───────────────────────┐   │
│  │                    JavaScript 模块                     │   │
│  ├──────────┬──────────┬──────────┬──────────┬──────────┤   │
│  │  app.js  │  api.js  │ chart.js │ memory.js│  i18n.js │   │
│  │  主逻辑  │  API调用 │   图表   │   记忆   │  多语言  │   │
│  └──────────┴────┬─────┴──────────┴──────────┴──────────┘   │
└──────────────────┼──────────────────────────────────────────┘
                   │
                   │ HTTP Requests
                   ▼
┌─────────────────────────────────────────────────────────────┐
│                     后端 (Node.js Server)                    │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │                    server.js                         │    │
│  │  • 静态文件服务                                      │    │
│  │  • API 代理 (隐藏 API Key)                           │    │
│  │  • CORS 处理                                         │    │
│  └───────────────────────┬─────────────────────────────┘    │
└──────────────────────────┼──────────────────────────────────┘
                           │
                           │ API Calls
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                      外部 API 服务                           │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  Coinglass  │  │  DeepSeek   │  │    TradingView      │  │
│  │  行情数据   │  │   AI 对话   │  │    图表数据         │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## 📁 项目结构

```
mia-trading-ai/
├── index.html          # 主页面
├── server.js           # Node.js 后端服务器
├── start.bat           # Windows 启动脚本
├── package.json        # 项目配置
│
├── css/
│   └── style.css       # 样式表
│
├── js/
│   ├── app.js          # 主应用逻辑
│   ├── api.js          # API 调用封装
│   ├── chart.js        # TradingView 图表
│   ├── config.js       # 配置文件
│   ├── i18n.js         # 多语言支持
│   ├── indicators.js   # 技术指标计算
│   ├── memory.js       # Aicy 记忆系统
│   └── prompt.js       # AI 提示词
│
├── assets/
│   └── Aicy.png        # Aicy 头像
│
├── docs/               # 文档目录
│   ├── README.md
│   ├── architecture/
│   ├── guides/
│   ├── api/
│   └── design/
│
└── .github/            # GitHub 配置
    ├── ISSUE_TEMPLATE/
    └── PULL_REQUEST_TEMPLATE.md
```

---

## 🧩 模块说明

### 前端模块

| 模块 | 文件 | 职责 |
|------|------|------|
| **主应用** | `app.js` | 应用入口、UI 交互、事件处理 |
| **API 层** | `api.js` | 封装所有外部 API 调用 |
| **图表** | `chart.js` | TradingView Widget 管理 |
| **配置** | `config.js` | 应用配置常量 |
| **多语言** | `i18n.js` | 中英文切换 |
| **指标** | `indicators.js` | 技术指标计算逻辑 |
| **记忆** | `memory.js` | Aicy 人设、上下文管理 |
| **提示词** | `prompt.js` | AI 系统提示词 |

### 后端模块

| 模块 | 文件 | 职责 |
|------|------|------|
| **服务器** | `server.js` | 静态文件、API 代理 |

---

## 🔄 数据流

### 1. 行情数据流

```
用户选择币种 → app.js 触发 → api.js 请求 
    → server.js 代理 → Coinglass API 
    → 返回数据 → app.js 渲染 UI
```

### 2. AI 对话流

```
用户发送消息 → app.js 收集 → memory.js 构建上下文 
    → api.js 发送 → server.js 代理 → DeepSeek API 
    → 返回回复 → app.js 显示 → memory.js 存储
```

### 3. 图表数据流

```
app.js 初始化 → chart.js 创建 Widget 
    → TradingView 加载 → 实时更新
```

---

## 🔐 安全设计

### API Key 保护

```
前端 → 不包含 API Key
         ↓
server.js → 服务端注入 API Key
         ↓
外部 API → 安全请求
```

### 数据存储

| 数据 | 存储位置 | 安全性 |
|------|----------|--------|
| 用户偏好 | localStorage | 仅本地 |
| 对话历史 | localStorage | 仅本地 |
| API Key | 服务端环境变量 | 安全 |

---

## 📱 响应式设计

```
Desktop (> 900px)          Mobile (≤ 900px)
┌────────┬────────┐        ┌────────────────┐
│  图表  │  Aicy  │        │     图表       │
│        │  聊天  │        ├────────────────┤
├────────┴────────┤        │  Aicy 聊天     │
│    数据卡片     │        │  (可折叠)      │
└─────────────────┘        ├────────────────┤
                           │   数据卡片     │
                           └────────────────┘
```

---

## 🔮 未来架构演进

### v2.0 计划

```
当前架构                    未来架构
┌─────────┐                ┌─────────┐
│ Browser │                │ Browser │
└────┬────┘                └────┬────┘
     │                          │
┌────┴────┐                ┌────┴────┐
│ Node.js │                │ Node.js │
│ Server  │                │ Server  │
└────┬────┘                └────┬────┘
     │                          │
┌────┴────┐                ┌────┴────┐
│  APIs   │                │  APIs   │
└─────────┘                ├─────────┤
                           │ Database│ ← 好感度、长期记忆
                           ├─────────┤
                           │ Solana  │ ← Token 整合
                           └─────────┘
```

